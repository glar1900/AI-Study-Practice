<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í‹°ì¼“íŒ… ì‹œë®¬ë ˆì´ì…˜ - ì›¹ í¬ë¡¤ë§ ì‹¤ìŠµ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 24px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 1200px;
      width: 100%;
    }

    h1 {
      text-align: center;
      color: #2d3748;
      margin-bottom: 10px;
      font-size: 2.5rem;
      font-weight: 700;
    }

    .subtitle {
      text-align: center;
      color: #718096;
      margin-bottom: 30px;
      font-size: 0.95rem;
    }

    .screen {
      background: linear-gradient(to bottom, #4a5568, #2d3748);
      color: white;
      text-align: center;
      padding: 15px;
      border-radius: 12px 12px 0 0;
      margin-bottom: 30px;
      font-weight: 600;
      letter-spacing: 2px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .seats-grid {
      display: grid;
      grid-template-columns: 30px repeat(10, 1fr);
      gap: 8px;
      margin-bottom: 30px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }

    .row-label {
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #4a5568;
      font-size: 1rem;
    }

    .seat {
      aspect-ratio: 1;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.75rem;
      font-weight: 600;
      position: relative;
      overflow: hidden;
    }

    .seat::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.4);
      border-radius: 50%;
      transition: transform 0.4s ease;
    }

    .seat:hover::before {
      transform: translate(-50%, -50%) scale(1);
    }

    .seat.occupied {
      background: linear-gradient(135deg, #fc8181 0%, #f56565 100%);
      color: white;
      cursor: not-allowed;
    }

    .seat.available {
      background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
      color: white;
      box-shadow: 0 0 20px rgba(72, 187, 120, 0.6);
      animation: pulse 1s infinite;
    }

    .seat.selected {
      background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
      color: white;
      box-shadow: 0 0 20px rgba(66, 153, 225, 0.8);
      transform: scale(1.1);
    }

    @keyframes pulse {

      0%,
      100% {
        box-shadow: 0 0 20px rgba(72, 187, 120, 0.6);
      }

      50% {
        box-shadow: 0 0 30px rgba(72, 187, 120, 0.9);
      }
    }

    .legend {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .legend-box {
      width: 24px;
      height: 24px;
      border-radius: 6px;
    }

    .booking-panel {
      background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
      border-radius: 16px;
      padding: 30px;
      margin-top: 30px;
      min-height: 200px;
      border: 2px solid #e2e8f0;
    }

    .booking-panel h2 {
      color: #2d3748;
      margin-bottom: 20px;
      font-size: 1.5rem;
    }

    .booking-info {
      display: none;
    }

    .booking-info.active {
      display: block;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #cbd5e0;
    }

    .info-label {
      color: #4a5568;
      font-weight: 600;
    }

    .info-value {
      color: #2d3748;
      font-weight: 700;
    }

    .btn {
      padding: 14px 32px;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 20px;
      width: 100%;
      font-family: 'Noto Sans KR', sans-serif;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 20px;
      padding: 40px;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
      animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-50px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal h3 {
      color: #2d3748;
      margin-bottom: 20px;
      font-size: 1.5rem;
      text-align: center;
    }

    .modal-buttons {
      display: flex;
      gap: 15px;
      margin-top: 30px;
    }

    .btn-confirm {
      background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
      color: white;
      flex: 1;
    }

    .btn-cancel {
      background: linear-gradient(135deg, #fc8181 0%, #f56565 100%);
      color: white;
      flex: 1;
    }

    .message {
      display: none;
      padding: 20px;
      border-radius: 12px;
      margin-top: 20px;
      text-align: center;
      font-weight: 700;
      font-size: 1.1rem;
      animation: messageSlideIn 0.3s ease;
    }

    @keyframes messageSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message.active {
      display: block;
    }

    .message.success {
      background: linear-gradient(135deg, #9ae6b4 0%, #68d391 100%);
      color: #22543d;
    }

    .message.error {
      background: linear-gradient(135deg, #feb2b2 0%, #fc8181 100%);
      color: #742a2a;
    }

    .refresh-hint {
      text-align: center;
      color: #718096;
      font-size: 0.9rem;
      margin-top: 15px;
      font-style: italic;
    }

    .timer {
      text-align: center;
      font-size: 0.85rem;
      color: #e53e3e;
      margin-top: 10px;
      font-weight: 600;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>ğŸŸï¸ í‹°ì¼“íŒ… ì‹œë®¬ë ˆì´ì…˜</h1>
    <p class="subtitle">ì›¹ í¬ë¡¤ë§ ì‹¤ìŠµìš© - ì¢Œì„ì€ ëœë¤í•˜ê²Œ ì˜¤í”ˆë©ë‹ˆë‹¤ (ìƒˆë¡œê³ ì¹¨í•˜ì—¬ í™•ì¸)</p>

    <div class="screen">SCREEN</div>

    <div class="seats-grid" id="seatsGrid"></div>

    <div class="legend">
      <div class="legend-item">
        <div class="legend-box" style="background: linear-gradient(135deg, #fc8181 0%, #f56565 100%);"></div>
        <span>ì˜ˆì•½ë¨</span>
      </div>
      <div class="legend-item">
        <div class="legend-box" style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);"></div>
        <span>ì˜ˆì•½ê°€ëŠ¥</span>
      </div>
      <div class="legend-item">
        <div class="legend-box" style="background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);"></div>
        <span>ì„ íƒë¨</span>
      </div>
    </div>

    <div class="booking-panel">
      <h2>ì˜ˆë§¤ ì •ë³´</h2>
      <div id="bookingInfo" class="booking-info">
        <div class="info-row">
          <span class="info-label">ì¢Œì„ ë²ˆí˜¸</span>
          <span class="info-value" id="seatNumber">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">ë“±ê¸‰</span>
          <span class="info-value">ì¼ë°˜ì„</span>
        </div>
        <div class="info-row">
          <span class="info-label">ê°€ê²©</span>
          <span class="info-value">15,000ì›</span>
        </div>
        <div class="info-row">
          <span class="info-label">ì˜ˆë§¤ ì‹œê°„</span>
          <span class="info-value" id="bookingTime">-</span>
        </div>
        <div class="timer" id="timer"></div>
        <button class="btn btn-primary" id="confirmBtn">í™•ì¸</button>
      </div>
      <p class="refresh-hint">ğŸ’¡ ì¢Œì„ ì •ë³´ëŠ” ìºì‹œë˜ì–´ ìˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ì¢Œì„ì„ ë³´ë ¤ë©´ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”!</p>
    </div>

    <div id="message" class="message"></div>
  </div>

  <div id="modal" class="modal">
    <div class="modal-content">
      <h3>ì˜ˆë§¤ë¥¼ í™•ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h3>
      <p style="text-align: center; color: #718096; margin-top: 10px;">ì„ íƒí•œ ì¢Œì„ì„ ì˜ˆë§¤í•©ë‹ˆë‹¤.</p>
      <div class="modal-buttons">
        <button class="btn btn-confirm" id="modalConfirm">í™•ì¸</button>
        <button class="btn btn-cancel" id="modalCancel">ì·¨ì†Œ</button>
      </div>
    </div>
  </div>

  <script>
    const ROWS = 10;
    const COLS = 10;
    const ROW_LABELS = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
    const CACHE_KEY = 'ticketing_seat_cache';
    const CACHE_TIMESTAMP_KEY = 'ticketing_cache_timestamp';
    const NEXT_OPEN_TIME_KEY = 'ticketing_next_open_time';
    const CURRENT_OPEN_SEAT_KEY = 'ticketing_current_open_seat';
    const SEAT_OPEN_TIME_KEY = 'ticketing_seat_open_time';

    let selectedSeat = null;
    let seatAvailableTime = null;
    let bookingTimeLimit = null;

    // ì¢Œì„ ê·¸ë¦¬ë“œ ìƒì„±
    function createSeatsGrid() {
      const grid = document.getElementById('seatsGrid');
      grid.innerHTML = '';

      // í—¤ë” (ë¹ˆ ì…€ + ì—´ ë²ˆí˜¸)
      grid.appendChild(document.createElement('div')); // ë¹ˆ ì…€
      for (let col = 1; col <= COLS; col++) {
        const colLabel = document.createElement('div');
        colLabel.className = 'row-label';
        colLabel.textContent = col;
        grid.appendChild(colLabel);
      }

      // ì¢Œì„ ìƒì„±
      const seatStates = loadSeatsFromCache();

      for (let row = 0; row < ROWS; row++) {
        // í–‰ ë¼ë²¨
        const rowLabel = document.createElement('div');
        rowLabel.className = 'row-label';
        rowLabel.textContent = ROW_LABELS[row];
        grid.appendChild(rowLabel);

        // ì¢Œì„
        for (let col = 1; col <= COLS; col++) {
          const seatId = `${ROW_LABELS[row]}${col}`;
          const seat = document.createElement('button');
          seat.className = 'seat';
          seat.dataset.seatId = seatId;
          seat.textContent = seatId;

          const state = seatStates[seatId] || 'occupied';
          seat.classList.add(state);

          seat.addEventListener('click', () => handleSeatClick(seatId, seat));
          grid.appendChild(seat);
        }
      }
    }

    // ìºì‹œì—ì„œ ì¢Œì„ ìƒíƒœ ë¡œë“œ
    function loadSeatsFromCache() {
      const cached = localStorage.getItem(CACHE_KEY);
      if (cached) {
        return JSON.parse(cached);
      }

      // ì´ˆê¸° ìƒíƒœ: ëª¨ë‘ ì˜ˆì•½ë¨
      const initial = {};
      for (let row = 0; row < ROWS; row++) {
        for (let col = 1; col <= COLS; col++) {
          initial[`${ROW_LABELS[row]}${col}`] = 'occupied';
        }
      }
      saveSeatsToCache(initial);
      return initial;
    }

    // ìºì‹œì— ì¢Œì„ ìƒíƒœ ì €ì¥
    function saveSeatsToCache(seats) {
      localStorage.setItem(CACHE_KEY, JSON.stringify(seats));
      localStorage.setItem(CACHE_TIMESTAMP_KEY, Date.now());
    }

    // ì¢Œì„ í´ë¦­ í•¸ë“¤ëŸ¬
    function handleSeatClick(seatId, seatElement) {
      const state = seatElement.classList.contains('available') ? 'available' :
        seatElement.classList.contains('occupied') ? 'occupied' : 'selected';

      if (state === 'occupied') {
        showMessage('ì´ë¯¸ ì˜ˆì•½ëœ ì¢Œì„ì…ë‹ˆë‹¤.', 'error');
        return;
      }

      // ì´ì „ ì„ íƒ í•´ì œ
      document.querySelectorAll('.seat.selected').forEach(s => {
        if (s !== seatElement) {
          s.classList.remove('selected');
          s.classList.add('available');
        }
      });

      // í˜„ì¬ ì¢Œì„ ì„ íƒ
      if (state === 'available') {
        seatElement.classList.remove('available');
        seatElement.classList.add('selected');
        selectedSeat = seatId;
        showBookingInfo(seatId);
      }
    }

    // ì˜ˆë§¤ ì •ë³´ í‘œì‹œ
    function showBookingInfo(seatId) {
      const bookingInfo = document.getElementById('bookingInfo');
      const seatNumber = document.getElementById('seatNumber');
      const bookingTime = document.getElementById('bookingTime');
      const timer = document.getElementById('timer');

      seatNumber.textContent = seatId;
      bookingTime.textContent = new Date().toLocaleTimeString('ko-KR');

      bookingInfo.classList.add('active');

      // íƒ€ì´ë¨¸ í‘œì‹œ
      if (seatAvailableTime) {
        const timeLeft = 1000 - (Date.now() - seatAvailableTime);
        bookingTimeLimit = seatAvailableTime + 1000;

        const updateTimer = setInterval(() => {
          const remaining = bookingTimeLimit - Date.now();
          if (remaining <= 0) {
            clearInterval(updateTimer);
            timer.textContent = 'ì‹œê°„ ì´ˆê³¼!';
            timer.style.color = '#e53e3e';
          } else {
            timer.textContent = `ë‚¨ì€ ì‹œê°„: ${(remaining / 1000).toFixed(1)}ì´ˆ`;
            timer.style.color = remaining < 500 ? '#e53e3e' : '#d69e2e';
          }
        }, 100);
      }
    }

    // ë©”ì‹œì§€ í‘œì‹œ
    function showMessage(text, type) {
      const message = document.getElementById('message');
      message.textContent = text;
      message.className = `message ${type} active`;

      setTimeout(() => {
        message.classList.remove('active');
      }, 3000);
    }

    // í™•ì¸ ë²„íŠ¼
    document.getElementById('confirmBtn').addEventListener('click', () => {
      if (!selectedSeat) return;

      document.getElementById('modal').classList.add('active');
    });

    // ëª¨ë‹¬ í™•ì¸
    document.getElementById('modalConfirm').addEventListener('click', () => {
      const modal = document.getElementById('modal');
      modal.classList.remove('active');

      if (!selectedSeat || !bookingTimeLimit) {
        showMessage('ì¢Œì„ì„ ë‹¤ì‹œ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
        return;
      }

      const now = Date.now();
      if (now <= bookingTimeLimit) {
        showMessage('âœ… ì˜ˆë§¤ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤!', 'success');

        // ì¢Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸
        const seats = loadSeatsFromCache();
        seats[selectedSeat] = 'occupied';
        saveSeatsToCache(seats);

        // UI ì—…ë°ì´íŠ¸
        const seatElement = document.querySelector(`[data-seat-id="${selectedSeat}"]`);
        if (seatElement) {
          seatElement.classList.remove('selected', 'available');
          seatElement.classList.add('occupied');
        }

        // ì˜ˆë§¤ ì •ë³´ ìˆ¨ê¸°ê¸°
        document.getElementById('bookingInfo').classList.remove('active');
        selectedSeat = null;
        bookingTimeLimit = null;
      } else {
        showMessage('â° ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');

        // ì¢Œì„ ìƒíƒœ ë³µêµ¬
        const seatElement = document.querySelector(`[data-seat-id="${selectedSeat}"]`);
        if (seatElement) {
          seatElement.classList.remove('selected');
          seatElement.classList.add('occupied');
        }

        document.getElementById('bookingInfo').classList.remove('active');
        selectedSeat = null;
        bookingTimeLimit = null;
      }
    });

    // ëª¨ë‹¬ ì·¨ì†Œ
    document.getElementById('modalCancel').addEventListener('click', () => {
      document.getElementById('modal').classList.remove('active');
    });

    // ì¢Œì„ ìƒíƒœ ì²´í¬ ë° ì—…ë°ì´íŠ¸ (í˜ì´ì§€ ë¡œë“œ ì‹œ)
    function checkAndUpdateSeatStatus() {
      const now = Date.now();
      const currentOpenSeat = localStorage.getItem(CURRENT_OPEN_SEAT_KEY);
      const seatOpenTime = parseInt(localStorage.getItem(SEAT_OPEN_TIME_KEY) || '0');

      // í˜„ì¬ ì˜¤í”ˆëœ ì¢Œì„ì´ ìˆëŠ” ê²½ìš°
      if (currentOpenSeat && seatOpenTime) {
        const elapsed = now - seatOpenTime;

        if (elapsed >= 1000) {
          // 1ì´ˆê°€ ì§€ë‚¬ìœ¼ë©´ ì¢Œì„ ë‹«ê¸°
          const seats = loadSeatsFromCache();
          if (seats[currentOpenSeat] === 'available') {
            seats[currentOpenSeat] = 'occupied';
            saveSeatsToCache(seats);
          }
          localStorage.removeItem(CURRENT_OPEN_SEAT_KEY);
          localStorage.removeItem(SEAT_OPEN_TIME_KEY);
        } else {
          // ì•„ì§ 1ì´ˆê°€ ì•ˆ ì§€ë‚¬ìœ¼ë©´ ë‚¨ì€ ì‹œê°„ í›„ ë‹«ê¸°
          const remainingTime = 1000 - elapsed;
          seatAvailableTime = seatOpenTime;

          setTimeout(() => {
            const seats = loadSeatsFromCache();
            if (seats[currentOpenSeat] === 'available') {
              seats[currentOpenSeat] = 'occupied';
              saveSeatsToCache(seats);
            }
            localStorage.removeItem(CURRENT_OPEN_SEAT_KEY);
            localStorage.removeItem(SEAT_OPEN_TIME_KEY);
          }, remainingTime);
        }
      }
    }

    // ì¢Œì„ ì˜¤í”ˆ í•¨ìˆ˜
    function openRandomSeat() {
      const seats = loadSeatsFromCache();
      const occupiedSeats = Object.keys(seats).filter(id => seats[id] === 'occupied');

      if (occupiedSeats.length > 0) {
        const randomSeat = occupiedSeats[Math.floor(Math.random() * occupiedSeats.length)];
        const openTime = Date.now();

        seats[randomSeat] = 'available';
        saveSeatsToCache(seats);
        seatAvailableTime = openTime;

        // localStorageì— í˜„ì¬ ì˜¤í”ˆ ì¢Œì„ ì •ë³´ ì €ì¥
        localStorage.setItem(CURRENT_OPEN_SEAT_KEY, randomSeat);
        localStorage.setItem(SEAT_OPEN_TIME_KEY, openTime.toString());

        // 1ì´ˆ í›„ ë‹¤ì‹œ ì˜ˆì•½ë¨ìœ¼ë¡œ ë³€ê²½
        setTimeout(() => {
          const updatedSeats = loadSeatsFromCache();
          if (updatedSeats[randomSeat] === 'available') {
            updatedSeats[randomSeat] = 'occupied';
            saveSeatsToCache(updatedSeats);
          }
          localStorage.removeItem(CURRENT_OPEN_SEAT_KEY);
          localStorage.removeItem(SEAT_OPEN_TIME_KEY);
        }, 1000);
      }

      // ë‹¤ìŒ ì˜¤í”ˆ ì‹œê°„ ê³„ì‚° ë° ì €ì¥ (10-30ì´ˆ)
      const nextInterval = (Math.random() * 20 + 10) * 1000;
      const nextOpenTime = Date.now() + nextInterval;
      localStorage.setItem(NEXT_OPEN_TIME_KEY, nextOpenTime.toString());

      setTimeout(openRandomSeat, nextInterval);
    }

    // ëœë¤ ì¢Œì„ ì˜¤í”ˆ ì‹œì‘
    function startRandomSeatOpening() {
      const now = Date.now();
      const nextOpenTime = parseInt(localStorage.getItem(NEXT_OPEN_TIME_KEY) || '0');

      if (nextOpenTime && nextOpenTime > now) {
        // ì´ë¯¸ ì˜ˆì•½ëœ ë‹¤ìŒ ì˜¤í”ˆ ì‹œê°„ì´ ìˆê³  ë¯¸ë˜ì¸ ê²½ìš°
        const waitTime = nextOpenTime - now;
        setTimeout(openRandomSeat, waitTime);
      } else {
        // ì˜ˆì•½ëœ ì‹œê°„ì´ ì—†ê±°ë‚˜ ì´ë¯¸ ì§€ë‚œ ê²½ìš° - ì¦‰ì‹œ ë˜ëŠ” ì§§ì€ ì‹œê°„ í›„ ì˜¤í”ˆ
        const initialDelay = nextOpenTime ? 0 : (Math.random() * 3 + 2) * 1000;
        setTimeout(openRandomSeat, initialDelay);
      }
    }

    // ì´ˆê¸°í™”
    checkAndUpdateSeatStatus();  // ë¨¼ì € ì¢Œì„ ìƒíƒœ ì²´í¬
    createSeatsGrid();
    startRandomSeatOpening();
  </script>
</body>

</html>